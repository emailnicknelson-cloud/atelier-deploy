<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper Workshop | Professional Event Planning Suite</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #e4e4dc;
            min-height: 100vh;
            padding: 60px 20px;
            color: #3d3d3d;
            line-height: 1.6;
        }

        /* Splash Screen Styles */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #e4e4dc;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.8s ease-in-out;
        }

        #splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            max-width: 400px;
            width: 80%;
            height: auto;
            opacity: 0;
            transform: scale(0.95);
            animation: logoFadeIn 1s ease-out forwards;
        }

        @keyframes logoFadeIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Main Content */
        #main-content {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        #main-content.visible {
            opacity: 1;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 40px;
            border-bottom: 1px solid rgba(61, 61, 61, 0.15);
        }

        .brand {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3em;
            font-weight: 500;
            color: #3d3d3d;
            margin-bottom: 8px;
            letter-spacing: 0.02em;
        }

        .tagline {
            font-size: 0.95em;
            color: #666;
            font-weight: 300;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .suite-overview {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 8px;
            padding: 40px;
            margin-bottom: 50px;
        }

        .suite-overview h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1em;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #3d3d3d;
            margin-bottom: 25px;
            text-align: center;
        }

        .tech-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tech-feature {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 6px;
            border-left: 2px solid #8b7355;
            transition: all 0.3s ease;
        }

        .tech-feature:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(3px);
        }

        .tech-icon {
            font-size: 1.2em;
            flex-shrink: 0;
            margin-top: 2px;
            opacity: 0.7;
        }

        .tech-text {
            font-size: 0.85em;
            color: #555;
            line-height: 1.5;
        }

        .tech-text strong {
            color: #3d3d3d;
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            font-size: 0.95em;
        }

        .suite-description {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15em;
            color: #555;
            line-height: 1.7;
            font-style: italic;
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            border: 1px solid rgba(61, 61, 61, 0.08);
        }

        .tools-section h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3em;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #3d3d3d;
            margin-bottom: 30px;
            text-align: center;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 12px;
            margin-bottom: 60px;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 6px;
            padding: 22px 20px;
            text-decoration: none;
            color: inherit;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .tool-card:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(139, 115, 85, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(61, 61, 61, 0.08);
        }

        .tool-card:hover .external-indicator {
            opacity: 1;
        }

        .tool-icon {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid rgba(61, 61, 61, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .tool-card:hover .tool-icon {
            background: #3d3d3d;
            border-color: #3d3d3d;
        }

        .tool-info {
            flex-grow: 1;
        }

        .tool-name {
            font-weight: 500;
            font-size: 0.95em;
            margin-bottom: 2px;
            color: #3d3d3d;
            letter-spacing: 0.02em;
        }

        .tool-desc {
            font-size: 0.8em;
            color: #777;
            font-weight: 300;
        }

        .external-indicator {
            color: #8b7355;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        /* HUD MERGED STYLES */
        /* Upload Section */
        .upload-section {
            margin-bottom: 3rem;
        }

        .upload-section .card {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 6px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .upload-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        #fileInput {
            display: none;
        }

        /* Data Display Grid */
        .loaded-data-section {
            margin-bottom: 3rem;
        }

        .loaded-data-section h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #3d3d3d;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .data-card {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 6px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .data-card:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(139, 115, 85, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(61, 61, 61, 0.08);
        }

        .data-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-description {
            color: #666;
            font-size: 0.875rem;
        }

        .data-preview {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(61, 61, 61, 0.15);
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #666;
            font-size: 0.875rem;
        }

        .data-value {
            font-weight: 600;
        }

        .import-timestamp {
            font-size: 0.75rem;
            color: #999;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(61, 61, 61, 0.15);
        }

        /* Buttons from HUD */
        button {
            background: #8b7355;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        button:hover {
            background: #6b5a45;
            transform: translateY(-1px);
            box-shadow: 0 2px 10px rgba(139, 115, 85, 0.3);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: #333;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .toast.success {
            background-color: #8b7355;
        }

        .toast.error {
            background-color: #D32F2F;
        }

        .toast.info {
            background-color: #1976D2;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.removing {
            animation: slideOut 0.3s ease;
        }

        .tool-card.loaded {
            border-color: rgba(139, 115, 85, 0.4);
            background: rgba(139, 115, 85, 0.08);
        }

        .badge {
            background: #8b7355;
            color: white;
            width: 1.75rem;
            height: 1.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 500;
            font-size: 0.75rem;
            flex-shrink: 0;
            margin-left: auto;
        }

        .footer {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid rgba(61, 61, 61, 0.15);
            color: #888;
            font-size: 0.85em;
            font-weight: 300;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .version-badge {
            display: inline-block;
            background: rgba(139, 115, 85, 0.1);
            color: #8b7355;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 500;
            letter-spacing: 0.05em;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }

        .atelier-link {
            color: #8b7355;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 400;
            letter-spacing: 0.03em;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .atelier-link:hover {
            color: #6b5a45;
            transform: translateX(-3px);
        }

        .atelier-link::before {
            content: "‚Üê";
            font-size: 0.9em;
        }

        @media (max-width: 600px) {
            body {
                padding: 40px 16px;
            }

            .brand {
                font-size: 2.2em;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .tech-features {
                grid-template-columns: 1fr;
            }

            .suite-overview {
                padding: 25px;
            }

            .splash-logo {
                max-width: 280px;
            }

            .tool-card {
                padding: 18px 16px;
            }
        }
    </style>
</head>

<body>
    <!-- Splash Screen -->
    <div id="splash-screen">
        <img src="https://whisperworkshop.com/whisperworkshop.jpeg" alt="Whisper Workshop" class="splash-logo">
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <div class="container">
            <header>
                <h1 class="brand">Whisper Workshop</h1>
                <p class="tagline">Professional Event Planning Suite</p>
            </header>

            <div class="suite-overview">
                <!-- Upload Section (HUD) -->
                <div class="upload-section" style="margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title" style="justify-content: center;">
                                <span class="emoji">üì•</span>
                                Import Tool Data
                            </h2>
                        </div>
                        <p class="card-description">Upload JSON files exported from Whisper Workshop tools to visualize
                            them below.</p>
                        <div
                            style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button onclick="document.getElementById('fileInput').click()">
                                <span class="upload-icon">üì§</span>Choose JSON File
                            </button>
                            <button onclick="scanLocalStorage()"
                                style="background: #e4e4dc; color: #3d3d3d; border: 1px solid rgba(61,61,61,0.2);">
                                <span class="upload-icon">üîÑ</span>Sync from Browser
                            </button>
                        </div>
                        <input type="file" id="fileInput" accept=".json">
                    </div>
                </div>

                <!-- Loaded Data Section (HUD - Initially Hidden) -->
                <div id="loadedDataSection" class="loaded-data-section" style="display: none;">
                    <h2>Loaded Data</h2>
                    <div id="dataGrid" class="data-grid"></div>
                </div>

                <h2>Technical Foundation</h2>
                <div class="tech-features">
                    <div class="tech-feature">
                        <span class="tech-icon">üíæ</span>
                        <div class="tech-text">
                            <strong>Data Persistence</strong>
                            All tools use localStorage with versioned keys
                        </div>
                    </div>
                    <div class="tech-feature">
                        <span class="tech-icon">üîÑ</span>
                        <div class="tech-text">
                            <strong>Import/Export JSON</strong>
                            Backup and sharing capabilities
                        </div>
                    </div>
                    <div class="tech-feature">
                        <span class="tech-icon">üîó</span>
                        <div class="tech-text">
                            <strong>Cross-Tool Integration</strong>
                            Shared storage keys for seamless data flow
                        </div>
                    </div>
                    <div class="tech-feature">
                        <span class="tech-icon">üñ®Ô∏è</span>
                        <div class="tech-text">
                            <strong>Print-Optimized</strong>
                            Professional CSS for physical output
                        </div>
                    </div>
                </div>
                <p class="suite-description">
                    The complete 12-tool suite provides comprehensive event planning capabilities from initial guest
                    management through day-of coordination and post-event gratuity handling.
                </p>
            </div>

            <div class="tools-section">
                <h2>Suite Navigation</h2>
                <div class="tools-grid">
                    <a href="index.html" class="tool-card">
                        <div class="tool-icon">üè†</div>
                        <div class="tool-info">
                            <div class="tool-name">Atelier Home</div>
                            <div class="tool-desc">Return to welcome screen</div>
                        </div>
                    </a>
                </div>
            </div>

            <div class="tools-section">
                <h2>Event Planning Tools</h2>
                <div class="tools-grid">
                    <a href="bar-calculator.html" class="tool-card">
                        <div class="tool-icon">üç∏</div>
                        <div class="tool-info">
                            <div class="tool-name">Bar Calculator</div>
                            <div class="tool-desc">Beverage quantities & costs</div>
                        </div>
                    </a>

                    <a href="budget-calculator.html" class="tool-card">
                        <div class="tool-icon">üí∞</div>
                        <div class="tool-info">
                            <div class="tool-name">Budget Calculator</div>
                            <div class="tool-desc">Financial planning & tracking</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="floor-plan-designer.html" class="tool-card">
                        <div class="tool-icon">üìê</div>
                        <div class="tool-info">
                            <div class="tool-name">Floor Plan Designer</div>
                            <div class="tool-desc">Venue layout visualization</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="guest-list.html" class="tool-card">
                        <div class="tool-icon">üë•</div>
                        <div class="tool-info">
                            <div class="tool-name">Guest List</div>
                            <div class="tool-desc">Manage attendee details</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="gratuity-calculator.html" class="tool-card">
                        <div class="tool-icon">üíµ</div>
                        <div class="tool-info">
                            <div class="tool-name">Gratuity Calculator</div>
                            <div class="tool-desc">Tip distribution & totals</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="invitation-tracker.html" class="tool-card">
                        <div class="tool-icon">üíå</div>
                        <div class="tool-info">
                            <div class="tool-name">Invitation Tracker</div>
                            <div class="tool-desc">RSVP management</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="menu-planner.html" class="tool-card">
                        <div class="tool-icon">üçΩÔ∏è</div>
                        <div class="tool-info">
                            <div class="tool-name">Menu Planner</div>
                            <div class="tool-desc">Catering coordination</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="playlist-timer.html" class="tool-card">
                        <div class="tool-icon">üéµ</div>
                        <div class="tool-info">
                            <div class="tool-name">Playlist Timer</div>
                            <div class="tool-desc">Music scheduling</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="rain-plan-calculator.html" class="tool-card">
                        <div class="tool-icon">üåßÔ∏è</div>
                        <div class="tool-info">
                            <div class="tool-name">Rain Plan Calculator</div>
                            <div class="tool-desc">Weather contingency planning</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="seating-chart-builder.html" class="tool-card">
                        <div class="tool-icon">ü™ë</div>
                        <div class="tool-info">
                            <div class="tool-name">Seating Chart Builder</div>
                            <div class="tool-desc">Guest arrangement tool</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="timeline-scheduler.html" class="tool-card">
                        <div class="tool-icon">üìÖ</div>
                        <div class="tool-info">
                            <div class="tool-name">Timeline Scheduler</div>
                            <div class="tool-desc">Event day coordination</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>

                    <a href="vendor-comparison.html" class="tool-card">
                        <div class="tool-icon">üè™</div>
                        <div class="tool-info">
                            <div class="tool-name">Vendor Comparison</div>
                            <div class="tool-desc">Supplier evaluation</div>
                        </div>
                        <span class="external-indicator">‚Üó</span>
                    </a>
                </div>
            </div>

            <div class="footer">
                <!-- <a href="index.html" class="atelier-link">Return to Atelier</a> -->
                <span class="version-badge">v2.0 Enterprise Suite</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const splash = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');

            setTimeout(function () {
                splash.classList.add('fade-out');
                mainContent.classList.add('visible');

                setTimeout(function () {
                    splash.style.display = 'none';
                }, 800);
            }, 2000);

            // Initialize HUD features
            initializeToolsGrid();
            scanLocalStorage(); // Auto-scan on load
        });

        // --- HUD LOGIC ---

        const STORAGE_KEYS = {
            barCalculator: 'event_bar_v1',
            budgetCalculator: 'event_budget_v1',
            floorPlanDesigner: 'event_floorplan_v1',
            guestList: 'event_guests_v1',
            gratuityCalculator: 'event_gratuity_v1',
            invitationTracker: 'event_invitations_v1',
            menuPlanner: 'event_menu_v1',
            playlistTimer: 'event_playlist_v1',
            rainPlanCalculator: 'event_rainplan_v1',
            seatingChart: 'event_seating_v1',
            timelineScheduler: 'event_timeline_v1',
            vendorComparison: 'event_vendors_v1'
        };

        // State
        let toolsData = {};
        let selectedTool = null;

        // Initialize tools grid badges
        function initializeToolsGrid() {
            // This function now just adds badges to existing links in the grid
            const toolCards = document.querySelectorAll('.tools-grid .tool-card');

            toolCards.forEach(card => {
                const href = card.getAttribute('href');
                if (!href || href === 'index.html') return;

                // Find key mapping based on href
                let key = null;
                for (const [k, v] of Object.entries(STORAGE_KEYS)) {
                    // Primitive check: if href contains the tool name roughly
                    // Actually, let's Map href to key explicitly or just check all keys
                    // Simpler: Reverse lookup the KEY from the href filename?
                    // mapping: bar-calculator.html -> barCalculator
                    const filename = href.replace('.html', '');
                    // Convert kebab-case to camelCase
                    const camelKey = filename.replace(/-./g, x => x[1].toUpperCase());

                    if (STORAGE_KEYS[camelKey]) {
                        key = camelKey;
                    }
                }

                // Fallback for seating-chart-builder -> seatingChart mapping
                if (href === 'seating-chart-builder.html') key = 'seatingChart';

                if (key && toolsData[key]) {
                    card.classList.add('loaded');
                    if (!card.querySelector('.badge')) {
                        card.insertAdjacentHTML('beforeend', '<div class="badge">‚úì</div>');
                    }
                } else {
                    card.classList.remove('loaded');
                    const badge = card.querySelector('.badge');
                    if (badge) badge.remove();
                }
            });
        }

        // Render data grid
        function renderDataGrid() {
            const dataGrid = document.getElementById('dataGrid');
            const loadedDataSection = document.getElementById('loadedDataSection');

            if (Object.keys(toolsData).length === 0) {
                loadedDataSection.style.display = 'none';
                return;
            }

            loadedDataSection.style.display = 'block';

            dataGrid.innerHTML = Object.entries(toolsData).map(([key, tool]) => {
                const preview = renderDataPreview(tool);
                // We don't have tool.emoji/name directly in toolsData usually if generic scan?
                // Wait, scanLocalStorage constructs toolsData.
                // We need to ensure toolsData has metadata.
                // We'll rely on the scanLocalStorage to populate metadata.

                return `
                    <div class="card data-card">
                        <div class="card-header" onclick="toggleDataCard('${key}')">
                            <div style="flex: 1;">
                                <div class="card-title">
                                    <span class="emoji">${tool.emoji || 'üì¶'}</span>
                                    <span>${tool.name || key}</span>
                                </div>
                                <p class="card-description">${tool.description || 'Imported Data'}</p>
                            </div>
                             <div style="display:flex; gap:0.5rem; align-items:center;">
                                <button onclick="event.stopPropagation(); clearToolData('${key}')" style="background:none; border:none; cursor:pointer; font-size:1.2rem; color:#aaa;" title="Remove Data">üóëÔ∏è</button>
                            </div>
                        </div>
                        ${selectedTool === key ? `
                            <div class="data-preview">
                                ${preview}
                                <div class="import-timestamp">
                                    Imported: ${new Date(tool.timestamp).toLocaleString()}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            initializeToolsGrid(); // Update badges
        }

        function toggleDataCard(key) {
            selectedTool = selectedTool === key ? null : key;
            renderDataGrid();
        }

        function clearToolData(key) {
            if (confirm(`Remove data for ${toolsData[key].name}?`)) {
                delete toolsData[key];
                showToast('Data removed', 'info');
                renderDataGrid();
            }
        }

        // Render data preview
        function renderDataPreview(tool) {
            if (tool.key === "barCalculator" && tool.data.results) {
                return `
                        <div class="data-row">
                            <span class="data-label">Total Drinks Needed</span>
                            <span class="data-value">${tool.data.results.totalDrinks}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Estimated Total Cost</span>
                            <span class="data-value">$${tool.data.results.totalCost?.toFixed(2)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Number of Guests</span>
                            <span class="data-value">${tool.data.inputs?.guests}</span>
                        </div>
                    `;
            } else if ((tool.key === "floorPlanDesigner" || tool.key === "seatingChart") && tool.data.objects) {
                return renderFloorPlanSVG(tool.data);
            }

            return `<pre style="font-size: 0.75rem; overflow: auto; max-height: 160px; background: #f0f0f0; padding: 0.75rem; border-radius: 0.25rem;">${JSON.stringify(tool.data, null, 2)}</pre>`;
        }

        // Helper to render Floor Plan SVG
        function renderFloorPlanSVG(data) {
            if (!data.room || !data.objects) return '<div class="data-row">Invalid Floor Plan Data</div>';

            const { width, length } = data.room;
            const padding = 2;
            const viewBox = `${-padding} ${-padding} ${width + padding * 2} ${length + padding * 2}`;

            const objectsSVG = data.objects.map(obj => {
                if (obj.shape === 'rect' || obj.shape === 'wall') {
                    const color = obj.shape === 'wall' ? '#000' : (obj.color || '#8b7355');
                    const x = obj.x - (obj.width / 2);
                    const y = obj.y - (obj.length / 2);
                    return `<rect x="${x}" y="${y}" width="${obj.width}" height="${obj.length}" fill="${color}" stroke="rgba(0,0,0,0.1)" stroke-width="0.2" rx="0.5" />`;
                } else if (obj.shape === 'circle') {
                    const color = obj.color || '#8b7355';
                    const r = obj.width / 2;
                    return `<circle cx="${obj.x}" cy="${obj.y}" r="${r}" fill="${color}" stroke="rgba(0,0,0,0.1)" stroke-width="0.2" />`;
                }
                return '';
            }).join('');

            return `
                <div style="width: 100%; aspect-ratio: ${width}/${length}; background: #fff; border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                    <svg viewBox="${viewBox}" style="width: 100%; height: 100%; display: block;">
                        <!-- Room Background -->
                        <rect x="0" y="0" width="${width}" height="${length}" fill="#f9f9f9" stroke="#ccc" stroke-width="0.2" />
                        <!-- Grid -->
                        <line x1="0" y1="0" x2="${width}" y2="${length}" stroke="#eee" stroke-width="0.1" />
                        <line x1="0" y1="${length}" x2="${width}" y2="0" stroke="#eee" stroke-width="0.1" />
                        ${objectsSVG}
                    </svg>
                </div>
                <div style="font-size: 0.75rem; color: #666; margin-top: 0.5rem; text-align: center;">
                    Room: ${width}' x ${length}' | Objects: ${data.objects.length}
                </div>
            `;
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Handle file upload
        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonData = JSON.parse(e.target?.result);
                    processImport(jsonData);
                } catch (error) {
                    console.error(error);
                    showToast("Invalid JSON file", 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        });

        function processImport(jsonData) {
            let detectedToolKey = null;
            let dataPayload = jsonData;

            if (jsonData.app === "WhisperWorkshop" && jsonData.type) {
                detectedToolKey = jsonData.type;
                dataPayload = jsonData.data;
            }
            // Heuristics
            else if (jsonData.inputs?.barType !== undefined) detectedToolKey = "barCalculator";
            else if (Array.isArray(jsonData) && jsonData.length > 0 && jsonData[0].rsvp) detectedToolKey = "guestList";
            else if (jsonData.items && jsonData.eventInfo) detectedToolKey = "timelineScheduler";
            else if (Array.isArray(jsonData) && jsonData.length > 0 && jsonData[0].quote) detectedToolKey = "vendorComparison";

            if (detectedToolKey && STORAGE_KEYS[detectedToolKey]) {
                const toolName = detectedToolKey.replace(/([A-Z])/g, ' $1').trim();

                // Map keys to Emoji/Desc manually since we don't have TOOL_CONFIGS array fully
                // Or we can rebuild it simply
                const META = {
                    barCalculator: { emoji: "üç∏", name: "Bar Calculator" },
                    budgetCalculator: { emoji: "üí∞", name: "Budget Calculator" },
                    floorPlanDesigner: { emoji: "üìê", name: "Floor Plan Designer" },
                    guestList: { emoji: "üë•", name: "Guest List" },
                    gratuityCalculator: { emoji: "üíµ", name: "Gratuity Calculator" },
                    invitationTracker: { emoji: "üíå", name: "Invitation Tracker" },
                    menuPlanner: { emoji: "üçΩÔ∏è", name: "Menu Planner" },
                    playlistTimer: { emoji: "üéµ", name: "Playlist Timer" },
                    rainPlanCalculator: { emoji: "üåßÔ∏è", name: "Rain Plan Calculator" },
                    seatingChart: { emoji: "ü™ë", name: "Seating Chart Builder" },
                    timelineScheduler: { emoji: "üìÖ", name: "Timeline Scheduler" },
                    vendorComparison: { emoji: "üè™", name: "Vendor Comparison" }
                };

                const meta = META[detectedToolKey] || { emoji: "üì¶", name: detectedToolKey };

                toolsData[detectedToolKey] = {
                    key: detectedToolKey,
                    name: meta.name,
                    emoji: meta.emoji,
                    description: "Imported from file",
                    timestamp: new Date().toISOString(),
                    data: dataPayload
                };

                // Save to localStorage so tool picks it up!
                try {
                    localStorage.setItem(STORAGE_KEYS[detectedToolKey], JSON.stringify(dataPayload));
                    showToast(`Imported ${meta.name} data`, 'success');
                } catch (e) {
                    showToast("Error saving to storage", 'error');
                }

                renderDataGrid();
            } else {
                showToast("Unknown file format", 'error');
            }
        }

        function scanLocalStorage() {
            let foundCount = 0;
            const META = {
                barCalculator: { emoji: "üç∏", name: "Bar Calculator" },
                budgetCalculator: { emoji: "üí∞", name: "Budget Calculator" },
                floorPlanDesigner: { emoji: "üìê", name: "Floor Plan Designer" },
                guestList: { emoji: "üë•", name: "Guest List" },
                gratuityCalculator: { emoji: "üíµ", name: "Gratuity Calculator" },
                invitationTracker: { emoji: "üíå", name: "Invitation Tracker" },
                menuPlanner: { emoji: "üçΩÔ∏è", name: "Menu Planner" },
                playlistTimer: { emoji: "üéµ", name: "Playlist Timer" },
                rainPlanCalculator: { emoji: "üåßÔ∏è", name: "Rain Plan Calculator" },
                seatingChart: { emoji: "ü™ë", name: "Seating Chart Builder" },
                timelineScheduler: { emoji: "üìÖ", name: "Timeline Scheduler" },
                vendorComparison: { emoji: "üè™", name: "Vendor Comparison" }
            };

            for (const [key, storageKey] of Object.entries(STORAGE_KEYS)) {
                const stored = localStorage.getItem(storageKey);
                if (stored) {
                    try {
                        const data = JSON.parse(stored);
                        const meta = META[key] || { emoji: "üì¶", name: key };

                        toolsData[key] = {
                            key: key,
                            name: meta.name,
                            emoji: meta.emoji,
                            description: "Synced from browser",
                            timestamp: new Date().toISOString(), // We don't know real timestamp unless stored
                            data: data
                        };
                        foundCount++;
                    } catch (e) {
                        console.error("Error parsing", key);
                    }
                }
            }
            renderDataGrid();
            if (foundCount > 0) {
                // Optional: showToast(`Synced ${foundCount} tools`, 'info');
            }
        }
    </script>
</body>

</html>